---
- name: Pipeline para exportar y transferir archivo desde IBM i
  hosts: ibmi_system
  gather_facts: false
  tasks:
    - name: Exportar archivo físico a CSV en IFS
      ibm.power_ibmi.ibm_cl_command:
        cmd: "CPYTOIMPF FROMFILE(MYLIB/MYFILE) TOSTMF('/tmp/MYFILE.csv') MBROPT(*REPLACE) STMFCODPAG(*PCASCII)"
      register: cpytoimpf_result

    - name: Verificar si CPYTOIMPF se ejecutó correctamente
      debug:
        msg: "{{ cpytoimpf_result.stdout }}"

    - name: Transferir archivo CSV desde IFS al localhost
      fetch:
        src: /tmp/MYFILE.csv
        dest: /ruta/local/en/localhost/
        flat: yes

    - name: Limpiar archivo temporal del IFS
      ibm.power_ibmi.ibm_cl_command:
        cmd: "RMVLNK OBJLNK('/tmp/MYFILE.csv')"


{'error': '*** error CPYTOIMPF FROMFILE(LIBPASES/PTFS) TOSTMF(/tmp/PTFS.csv) MBROPT(*REPLACE) STMFCODPAG(*PCASCII)', 'error1': '202', 'version': 'XML Toolkit 2.0.2-dev', 'xmlhint': 'CPYTOIMPF FROMFILE(LIBPASES/PTFS) TOSTMF(/tmp/PTFS.csv) MBRO', 'xmlhint2': 'CPYTOIMPF FROMFILE(LIBPASES/PTFS) TOSTMF(/tmp/PTFS.csv) MBRO', 'jobipc': '*na', 'jobipcskey': 'FFFFFFFF', 'jobname': 'QSQSRVR', 'jobuser': 'QUSER', 'jobnbr': '803002', 'curuser': 'CLIENTEANS', 'ccsid': '284', 'dftccsid': '284', 'paseccsid': '0', 'syslibl': 'QSYS QSYS2 QHLPSYS QUSRSYS', 'usrlibl': 'COMLIB QTEMP DMIRROR11 QGPL ZFUNC P$CMLIBPRO P$CMDATPRO CUBDDAT TPRCDAT'}
